<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel MI Bendiljati Wetan</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #043927; border-bottom: 3px solid #d4af37; padding-bottom: 10px; }
        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-save { background: #043927; color: white; width: 100%; }
        .btn-delete { background: #dc3545; color: white; padding: 5px 10px; }
        .btn-edit { background: #ffc107; color: black; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f8f8; }
        #loading { text-align: center; font-weight: bold; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h2>Update Konten Madrasah</h2>
    
    <div id="form-section">
        <select id="sheetName">
            <option value="Berita">Berita</option>
            <option value="Prestasi">Prestasi</option>
        </select>
        <input type="hidden" id="old_id">
        <input type="text" id="val1" placeholder="Judul / Nama Prestasi">
        <input type="text" id="val2" placeholder="Tanggal / Kategori">
        <textarea id="val3" placeholder="Isi Berita (Kosongkan jika Prestasi)"></textarea>
        <input type="text" id="val4" placeholder="URL Link Gambar">
        <button id="btn-submit" class="btn btn-save" onclick="simpanData()">SIMPAN DATA</button>
        <button id="btn-cancel" class="btn" style="display:none; margin-top:5px; width:100%" onclick="window.location.reload()">BATAL</button>
    </div>

    <hr>

    <h3>Daftar Konten Saat Ini</h3>
    <div id="loading">Memuat data...</div>
    <div id="daftar-konten"></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXZIrK-08GhyfiNBo7ErWeM8dtWQTTYoORGubt0HBM-Df03xdVOIheF19asYHpm7TKPw/exec"; // <-- PASTIIN URL BENAR
    let mode = "add";

    // Langsung minta password
    const password = prompt("Password Admin:");
    if (password !== "biasabisa") {
        alert("Salah!");
        window.location.href = "index.html";
    } else {
        fetchData();
    }

    async function fetchData() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            const container = document.getElementById('daftar-konten');
            container.innerHTML = ""; // Bersihkan kontainer

            // 1. Render Tabel Berita
            let htmlBerita = `<h3><i class="fas fa-newspaper"></i> Daftar Berita</h3><table>
                <tr><th>Judul Berita</th><th>Aksi</th></tr>`;
            data.berita.forEach(item => {
                htmlBerita += `<tr>
                    <td>${item[0]}</td>
                    <td>
                        <button class="btn btn-edit" onclick='siapkanEdit("Berita", ${JSON.stringify(item).replace(/"/g, '&quot;')})'>Edit</button>
                        <button class="btn btn-delete" onclick="hapusData('Berita', '${item[0]}')">Hapus</button>
                    </td>
                </tr>`;
            });
            htmlBerita += `</table><br>`;

            // 2. Render Tabel Prestasi
            let htmlPrestasi = `<h3><i class="fas fa-trophy"></i> Daftar Prestasi</h3><table>
                <tr><th>Nama Prestasi</th><th>Aksi</th></tr>`;
            data.prestasi.forEach(item => {
                htmlPrestasi += `<tr>
                    <td>${item[0]}</td>
                    <td>
                        <button class="btn btn-edit" onclick='siapkanEdit("Prestasi", ${JSON.stringify(item).replace(/"/g, '&quot;')})'>Edit</button>
                        <button class="btn btn-delete" onclick="hapusData('Prestasi', '${item[0]}')">Hapus</button>
                    </td>
                </tr>`;
            });
            htmlPrestasi += `</table>`;

            container.innerHTML = htmlBerita + htmlPrestasi;
            document.getElementById('loading').style.display = 'none';
        } catch (e) {
            document.getElementById('loading').innerText = "Gagal memuat data.";
        }
    }

    function siapkanEdit(type, data) {
        mode = "edit";
        document.getElementById('sheetName').value = type;
        document.getElementById('old_id').value = data[0]; // Judul lama sebagai kunci
        
        // Mengisi form berdasarkan tipe
        document.getElementById('val1').value = data[0]; // Judul
        document.getElementById('val2').value = data[1]; // Tanggal/Kategori
        
        if(type === "Berita") {
            document.getElementById('val3').style.display = "block";
            document.getElementById('val3').value = data[2]; // Isi
            document.getElementById('val4').value = data[3]; // Gambar
        } else {
            document.getElementById('val3').style.display = "none";
            document.getElementById('val3').value = "";      // Kosongkan isi
            document.getElementById('val4').value = data[2]; // Gambar (di prestasi index ke-2)
        }
        
        document.getElementById('btn-submit').innerText = "UPDATE DATA " + type.toUpperCase();
        document.getElementById('btn-cancel').style.display = "block";
        window.scrollTo(0,0);
    }

    async function hapusData(sheet, id) {
        if(!confirm("Hapus " + id + "?")) return;
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "delete", sheetName: sheet, id: id}) });
        location.reload();
    }
</script>
</body>
</html>
