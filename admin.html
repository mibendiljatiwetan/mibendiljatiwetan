<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel MI Bendiljati Wetan</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #043927; border-bottom: 3px solid #d4af37; padding-bottom: 10px; }
        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-save { background: #043927; color: white; width: 100%; }
        .btn-delete { background: #dc3545; color: white; padding: 5px 10px; }
        .btn-edit { background: #ffc107; color: black; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f8f8; }
        #loading { text-align: center; font-weight: bold; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h2>Update Konten Madrasah</h2>
    
    <div id="form-section">
        <select id="sheetName">
            <option value="Berita">Berita</option>
            <option value="Prestasi">Prestasi</option>
        </select>
        <input type="hidden" id="old_id">
        <input type="text" id="val1" placeholder="Judul / Nama Prestasi">
        <input type="text" id="val2" placeholder="Tanggal / Kategori">
        <textarea id="val3" placeholder="Isi Berita (Kosongkan jika Prestasi)"></textarea>
        <input type="text" id="val4" placeholder="URL Link Gambar">
        <button id="btn-submit" class="btn btn-save" onclick="simpanData()">SIMPAN DATA</button>
        <button id="btn-cancel" class="btn" style="display:none; margin-top:5px; width:100%" onclick="window.location.reload()">BATAL</button>
    </div>

    <hr>

    <h3>Daftar Konten Saat Ini</h3>
    <div id="loading">Memuat data...</div>
    <div id="daftar-konten"></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXZIrK-08GhyfiNBo7ErWeM8dtWQTTYoORGubt0HBM-Df03xdVOIheF19asYHpm7TKPw/exec"; // <-- PASTIIN URL BENAR
    let mode = "add";

    // Langsung minta password
    const password = prompt("Password Admin:");
    if (password !== "biasabisa") {
        alert("Salah!");
        window.location.href = "index.html";
    } else {
        fetchData();
    }

    async function fetchData() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            let html = `<table><tr><th>Judul</th><th>Aksi</th></tr>`;
            
            // Gabungkan berita & prestasi untuk daftar
            const semua = [
                ...data.berita.map(x => ({type: 'Berita', data: x})),
                ...data.prestasi.map(x => ({type: 'Prestasi', data: x}))
            ];

            semua.forEach(item => {
                html += `<tr>
                    <td>[${item.type}] ${item.data[0]}</td>
                    <td>
                        <button class="btn btn-edit" onclick='siapkanEdit("${item.type}", ${JSON.stringify(item.data)})'>Edit</button>
                        <button class="btn btn-delete" onclick="hapusData('${item.type}', '${item.data[0]}')">Hapus</button>
                    </td>
                </tr>`;
            });
            html += `</table>`;
            document.getElementById('daftar-konten').innerHTML = html;
            document.getElementById('loading').style.display = 'none';
        } catch (e) {
            document.getElementById('loading').innerText = "Gagal ambil data. Cek URL SCRIPT.";
        }
    }

    async function simpanData() {
        const btn = document.getElementById('btn-submit');
        btn.innerText = "Proses...";
        btn.disabled = true;

        const sheet = document.getElementById('sheetName').value;
        const rowData = [
            document.getElementById('val1').value,
            document.getElementById('val2').value,
            document.getElementById('val3').value,
            document.getElementById('val4').value
        ];
        if(sheet === "Prestasi") rowData.splice(2,1);

        const payload = {
            action: mode,
            sheetName: sheet,
            id: document.getElementById('old_id').value || rowData[0],
            data: rowData
        };

        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
        alert("Sukses!");
        location.reload();
    }

    function siapkanEdit(type, data) {
        mode = "edit";
        document.getElementById('sheetName').value = type;
        document.getElementById('old_id').value = data[0];
        document.getElementById('val1').value = data[0];
        document.getElementById('val2').value = data[1];
        if(type === "Berita") {
            document.getElementById('val3').value = data[2];
            document.getElementById('val4').value = data[3];
        } else {
            document.getElementById('val4').value = data[2];
        }
        document.getElementById('btn-submit').innerText = "UPDATE DATA";
        document.getElementById('btn-cancel').style.display = "block";
        window.scrollTo(0,0);
    }

    async function hapusData(sheet, id) {
        if(!confirm("Hapus " + id + "?")) return;
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "delete", sheetName: sheet, id: id}) });
        location.reload();
    }
</script>
</body>
</html>
